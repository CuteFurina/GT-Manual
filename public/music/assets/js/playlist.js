import{s as e,r as a,g as l,i as s,j as t,P as n,k as i,n as o,Y as u,ad as r,aF as c,b3 as d,aH as p,a1 as v,aa as m,ac as y,a7 as f,w as g,e as k,a6 as _,G as h,T as w,O as b,J as C,R as $,L as x,K as L,X as U,W as z,ah as I,aC as P,at as R,b1 as j,aJ as D,au as T,a0 as q,ap as G,aq as J,v as M}from"./vendor.js";import{g as S,G as F,H,_ as K,I as N,q as O,i as B,C as W,J as X,K as Y,e as A,z as E,B as Q,d as V,F as Z,L as ee,M as ae,N as le,f as se}from"./index.js";import{_ as te}from"./SongList.js";import"./Pagination.js";const ne={__name:"PlaylistUpdate",emits:["getPlayListDetailData"],setup(f,{expose:g,emit:k}){const _=S(),{textRule:h}=H(),{plCatList:w}=e(_),b=a(null),C=a(null),$=a(!1),x={name:h},L=a({name:null,desc:null,tags:null}),U=a([]),z=k,I=e=>{e.preventDefault(),C.value?.validate((async e=>{if(e)$message.error("请检查你的输入");else{200===(await F(b.value,L._value.name,L._value.desc,L._value.tags.join(";"))).code?(z("getPlayListDetailData",b.value,!0),await _.setUserLikePlaylists(),R(),$message.success("歌单编辑成功")):$message.error("歌单编辑失败，请重试")}}))},P=async()=>{w.value.catList?.length?U.value=w.value.catList.map((e=>({label:e.name,value:e.name}))):await _.setPlCatList()},R=()=>{$.value=!1,b.value=null};return g({openUpdateModal:e=>{L.value={name:e.name,desc:e.desc||e.description,tags:e.tags},b.value=e.id,$.value=!0}}),(e,a)=>{const f=r,g=c,k=d,_=p,h=v,w=m,b=y;return l(),s(b,{show:o($),"onUpdate:show":a[3]||(a[3]=e=>u($)?$.value=e:null),bordered:!1,"on-after-leave":R,title:"编辑歌单",preset:"card"},{footer:t((()=>[i(w,{justify:"end"},{default:t((()=>[i(h,{onClick:R},{default:t((()=>[n(" 取消 ")])),_:1}),i(h,{type:"primary",onClick:I},{default:t((()=>[n(" 编辑 ")])),_:1})])),_:1})])),default:t((()=>[i(_,{ref_key:"playlistUpdateRef",ref:C,rules:x,"label-width":80,model:o(L)},{default:t((()=>[i(g,{label:"歌单名称",path:"name"},{default:t((()=>[i(f,{value:o(L).name,"onUpdate:value":a[0]||(a[0]=e=>o(L).name=e),placeholder:"请输入歌单名称"},null,8,["value"])])),_:1}),i(g,{label:"歌单简介",path:"desc"},{default:t((()=>[i(f,{value:o(L).desc,"onUpdate:value":a[1]||(a[1]=e=>o(L).desc=e),autosize:{minRows:3,maxRows:6},type:"textarea",placeholder:"请输入歌单简介",maxlength:"800","show-count":"",clearable:""},null,8,["value"])])),_:1}),i(g,{label:"歌单标签",path:"tags"},{default:t((()=>[i(k,{value:o(L).tags,"onUpdate:value":a[2]||(a[2]=e=>o(L).tags=e),options:o(U),placeholder:"请选择歌单标签",multiple:"",onClick:P},null,8,["value","options"])])),_:1})])),_:1},8,["model"])])),_:1},8,["show"])}}},ie={key:0,class:"playlist"},oe={key:0,class:"detail"},ue={class:"cover"},re=(e=>(G("data-v-5c3d6d31"),e=e(),J(),e))((()=>C("div",{class:"cover-loading"},[C("img",{class:"loading-img",src:se,alt:"song"})],-1))),ce={class:"data"},de={class:"creator"},pe={key:0,class:"num-item"},ve={key:1,class:"num-item"},me={key:2,class:"num-item"},ye={key:1,class:"detail"},fe={class:"data"},ge={key:1,class:"title"},ke=K({__name:"playlist",setup(c){const d=f(),p=S(),{userLikeData:y,userData:G}=e(p),J=a("like-songs"===d.currentRoute.value.name?y.value.playlists?.[0]?.id||null:d.currentRoute.value.query.id),F=a(null),H=a(null),K=a(!1),se=a(null),ke=a(null),_e=a(null),he=a([]),we=e=>()=>M(z,null,{default:()=>M(A,{icon:e},null)}),be=a([]),Ce=async(e,a=!1)=>{try{if(!e)return!1;se.value=null,a||(ke.value=null);const l=await N(e);if(se.value=O(l.playlist,"playlist",!0)[0],(e=>{be.value=[{label:"公开隐私歌单",key:"privacy",show:10===e?.privacy,props:{onclick:()=>{Ue(J.value)}},icon:we("list-lock-open")},{label:"删除歌单",key:"delete",show:e?.userId===G.value?.userId,props:{onclick:()=>{Le()}},icon:we("delete")},{label:"打开源页面链接",key:"open",props:{onclick:()=>{const e=J.value;e&&window.open(`https://music.163.com/#/playlist?id=${e}`)}},icon:we("link")}]})(l.playlist),a)return!0;if(l.playlist.trackCount>=800)return await $e(e,l.playlist.trackCount),!0;K.value=l.playlist.userId===G.value?.userId;let s=null;if(B()&&K.value){if(!l.privileges)return ke.value="empty",!1;const e=l.privileges.map((e=>e.id)).join(",");s=await W(e)}else{const a=l.playlist.trackCount||0;s=await X(e,a)}s.songs?ke.value=O(s.songs,"song"):ke.value="error"}catch(l){console.error("获取歌单信息出错：",l),$message.error("获取歌单信息出错")}},$e=async(e,a)=>{H.value=$message.loading("该歌单歌曲数量过多，请稍等",{duration:0});let l=0;for(ke.value=[];(null===a||l<a)&&H.value;){const a=await X(e,800,l),s=O(a.songs,"song");ke.value=ke.value.concat(s),l+=800}H.value?.destroy(),H.value=null},xe=V((e=>{const a=e?.trim();if(!a||""===a)return!0;const l=Z(a,ke.value);he.value=l}),300),Le=()=>{if("like-songs"===d.currentRoute.value.name)return $message.warning("系统默认歌单无法删除"),!1;$dialog.warning({title:"删除歌单",content:"确认删除这个歌单？该操作无法撤销！",positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{200===(await ee(J.value)).code&&($message.success("歌单删除成功"),await p.setUserLikePlaylists())}})},Ue=async e=>{$dialog.warning({title:"公开歌单",content:"公开后将无法恢复为隐私歌单，是否确定将歌单公开？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{200===(await ae(e)).code&&($message.success("歌单已公开"),await Ce(e))}})},ze=e=>{const a=y.value.playlists;return!a.length||!a.some((a=>a.id===Number(e)))},Ie=V((async e=>{try{if(!B())return $message.warning("请登录后使用");const a=ze(e)?1:2;200===(await le(a,e)).code?($message.success((1===a?"收藏":"取消收藏")+"成功"),await p.setUserLikePlaylists()):$message.error((1===a?"收藏":"取消收藏")+"失败，请重试")}catch(a){console.error("收藏出错：",a),$message.error("收藏操作出现错误")}}),300);return g((()=>d.currentRoute.value),(async e=>{"playlist"!==e.name&&"like-songs"!==e.name||(J.value="like-songs"===d.currentRoute.value.name?y.value.playlists?.[0]?.id||null:e.query?.id,await Ce(J.value))})),k((async()=>{await Ce(J.value)})),_((()=>{H.value?.destroy(),H.value=null})),(e,a)=>{const c=I,p=b,f=P,g=R,k=m,_=j,G=D,M=v,S=T,N=r,O=te,B=q,W=ne;return o(J)?(l(),h("div",ie,[i(w,{name:"fade",mode:"out-in"},{default:t((()=>[o(se)&&Object.keys(o(se))?.length?(l(),h("div",oe,[C("div",ue,[i(c,{src:o(se).coverSize.l,"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":o(se).cover,class:"cover-img","show-toolbar-tooltip":"",onLoad:a[0]||(a[0]=e=>{e.target.style.opacity=1})},{placeholder:t((()=>[re])),_:1},8,["src","preview-src"]),i(c,{src:o(se).coverSize.m,class:"cover-shadow","preview-disabled":""},null,8,["src"])]),C("div",ce,[i(p,{class:"name"},{default:t((()=>[n($(o(y).playlists?.[0]?.id===o(J)?"我喜欢的音乐":o(se).name||"未知歌单"),1)])),_:1}),C("div",de,[i(f,{src:(o(se).creator?.avatarUrl+"?param=300y$300").replace(/^http:/,"https:"),"fallback-src":"/music/images/pic/avatar.jpg?assest",round:""},null,8,["src"]),i(p,{class:"nickname"},{default:t((()=>[n($(o(se).creator?.nickname||"未知创建者"),1)])),_:1}),o(se).createTime?(l(),s(p,{key:0,class:"create-time",depth:"3"},{default:t((()=>[n($(o(Y)(o(se).createTime))+" 创建 ",1)])),_:1})):x("",!0)]),o(se)?.tags?(l(),s(k,{key:0,class:"tags"},{default:t((()=>[(l(!0),h(L,null,U(o(se).tags,((e,a)=>(l(),s(g,{key:a,bordered:!1,class:"pl-tags",round:"",onClick:a=>o(d).push({path:"/discover/playlists",query:{cat:e}})},{default:t((()=>[n($(e),1)])),_:2},1032,["onClick"])))),128))])),_:1})):x("",!0),i(k,{class:"num"},{default:t((()=>[o(se).count?(l(),h("div",pe,[i(o(z),{depth:"3",size:"18"},{default:t((()=>[i(o(A),{icon:"music-note"})])),_:1}),i(p,{depth:"3"},{default:t((()=>[n($(o(se).count),1)])),_:1})])):x("",!0),o(se).playCount?(l(),h("div",ve,[i(o(z),{depth:"3",size:"18"},{default:t((()=>[i(o(A),{icon:"headphones"})])),_:1}),i(p,{depth:"3"},{default:t((()=>[n($(o(E)(o(se)?.playCount||0)),1)])),_:1})])):x("",!0),o(se).updateTime?(l(),h("div",me,[i(o(z),{depth:"3",size:"18"},{default:t((()=>[i(o(A),{icon:"update-rounded"})])),_:1}),i(p,{depth:"3"},{default:t((()=>[n($(o(Y)(o(se).updateTime)),1)])),_:1})])):x("",!0)])),_:1}),o(se).description?(l(),s(_,{key:1,tooltip:!1,class:"description","expand-trigger":"click","line-clamp":"2"},{default:t((()=>[i(p,{depth:"3"},{default:t((()=>[n($(o(se).description),1)])),_:1})])),_:1})):(l(),s(p,{key:2,class:"description"},{default:t((()=>[n("太懒了吧，连简介都没写")])),_:1}))])])):(l(),h("div",ye,[i(G,{class:"cover"}),C("div",fe,[i(G,{repeat:4,text:""})])]))])),_:1}),i(w,{name:"fade",mode:"out-in"},{default:t((()=>[(l(),s(k,{key:o(K),class:"menu",justify:"space-between"},{default:t((()=>[i(k,{class:"left"},{default:t((()=>[i(M,{disabled:null===o(ke)||"empty"===o(ke)||null!==o(H),focusable:!1,type:"primary",class:"play",tag:"div",circle:"",strong:"",secondary:"",onClick:a[1]||(a[1]=e=>o(Q)(o(ke)))},{icon:t((()=>[i(o(z),{size:"32"},{default:t((()=>[i(o(A),{icon:"play-arrow-rounded"})])),_:1})])),_:1},8,["disabled"]),o(K)?(l(),s(M,{key:1,focusable:!1,class:"like",size:"large",tag:"div",round:"",strong:"",secondary:"",onClick:a[3]||(a[3]=e=>o(F)?.openUpdateModal(o(se)))},{icon:t((()=>[i(o(z),null,{default:t((()=>[i(o(A),{icon:"edit"})])),_:1})])),default:t((()=>[n(" 编辑歌单 ")])),_:1})):(l(),s(M,{key:0,focusable:!1,class:"like",size:"large",tag:"div",round:"",strong:"",secondary:"",onClick:a[2]||(a[2]=e=>o(Ie)(o(J)))},{icon:t((()=>[i(o(z),null,{default:t((()=>[i(o(A),{icon:ze(o(J))?"favorite-outline-rounded":"favorite-rounded"},null,8,["icon"])])),_:1})])),default:t((()=>[n(" "+$(ze(o(J))?"收藏歌单":"取消收藏"),1)])),_:1})),i(S,{options:o(be),trigger:"hover",placement:"bottom-start"},{default:t((()=>[i(M,{focusable:!1,class:"more",size:"large",tag:"div",circle:"",strong:"",secondary:""},{icon:t((()=>[i(o(z),null,{default:t((()=>[i(o(A),{icon:"format-list-bulleted"})])),_:1})])),_:1})])),_:1},8,["options"])])),_:1}),i(k,{class:"right"},{default:t((()=>[i(w,{name:"fade",mode:"out-in"},{default:t((()=>["empty"!==o(ke)&&o(ke)?.length?(l(),s(N,{key:0,value:o(_e),"onUpdate:value":a[4]||(a[4]=e=>u(_e)?_e.value=e:null),"input-props":{autoComplete:!1},class:"search",placeholder:"模糊搜索",clearable:"",onInput:o(xe)},{prefix:t((()=>[i(o(z),{size:"18"},{default:t((()=>[i(o(A),{icon:"search-rounded"})])),_:1})])),_:1},8,["value","onInput"])):x("",!0)])),_:1})])),_:1})])),_:1}))])),_:1}),i(w,{name:"fade",mode:"out-in"},{default:t((()=>[o(_e)?o(he)?.length?(l(),s(O,{key:1,data:o(he),sourceId:o(J)},null,8,["data","sourceId"])):(l(),s(B,{key:2,description:`搜不到关于 ${o(_e)} 的任何歌曲呀`,style:{"margin-top":"60px"},size:"large"},{icon:t((()=>[i(o(z),null,{default:t((()=>[i(o(A),{icon:"search-off"})])),_:1})])),_:1},8,["description"])):(l(),s(O,{key:0,data:o(ke),sourceId:o(J)},null,8,["data","sourceId"]))])),_:1}),i(W,{ref_key:"playlistUpdateRef",ref:F,onGetPlayListDetailData:Ce},null,512)])):(l(),h("div",ge,[i(p,{class:"key"},{default:t((()=>[n("参数不完整")])),_:1}),i(M,{focusable:!1,class:"back",strong:"",secondary:"",onClick:a[5]||(a[5]=e=>o(d).go(-1))},{default:t((()=>[n(" 返回上一页 ")])),_:1})]))}}},[["__scopeId","data-v-5c3d6d31"]]);export{ke as default};
