import{_ as a,m as s,s as t,d as l,e,U as n,V as o}from"./index.js";import{_ as i}from"./SongList.js";import{r as c,w as r,f as u,g as m,i as d,j as b,T as f,Z as p,n as g,G as v,k as y,K as h,X as _,U as w,J as L,R as j,I as k,L as x,aw as E,aj as S,aE as C,W as A,aA as I,ap as B,aq as H}from"./vendor.js";import"./Pagination.js";const q=(a=>(B("data-v-108ead7f"),a=a(),H(),a))((()=>L("img",{class:"cover",src:n,alt:"album-cover"},null,-1))),z={class:"content"},D={class:"album"},P={class:"artist"},R=a({__name:"albums",props:{songList:{type:Array,default:()=>[]}},setup(a){const n=s(),B=t(),H=a,R=c(null),U=c(null),G=a=>{const s=new Map;a?.forEach((a=>{const t=a.artists?a.artists.split(/[/,&]/):[],l=a.album?a.album.trim():"";t.forEach((a=>{const t=a.trim();s.has(l)?(s.get(l).artists.add(t),s.get(l).num+=1):s.set(l,{artist:t,album:l,num:1,artists:new Set([t])})}))}));const t=Array.from(s.values()).sort(((a,s)=>a.album.localeCompare(s.album,"zh-Hans-CN",{sensitivity:"base"})));U.value=t?.[0]?.album||null,R.value=t,p().then((()=>{K()}))},J=(a,s)=>a.filter((a=>!(!a.album||!a.album.includes(s))&&a)),K=l((()=>{try{const a=document.getElementById("album-list");a.querySelectorAll(".cover").forEach((async(a,s)=>{if((a=>{const s=a.getBoundingClientRect();return s.top>=0&&s.bottom<=(window.innerHeight||document.documentElement.clientHeight)})(a)&&!a.classList.contains("loaded")){const t=await(async a=>{const s=J(H.songList,a)?.[0]?.path;return await o(s)})(R.value?.[s]?.album);t&&(a.classList.add("loaded"),a.src=t)}}))}catch(a){console.error("专辑封面获取失败：",a)}}),100);return r((()=>H.songList),(a=>G(a))),u((()=>{G(H.songList)})),(s,t)=>{const l=E,o=S,c=C,r=i,u=e,p=A,H=I;return m(),d(f,{name:"fade",mode:"out-in"},{default:b((()=>[g(R)?(m(),v("div",{key:0,style:k({height:`calc(100vh - ${Object.keys(g(n).playSongData)?.length&&g(B).showPlayBar?445:365}px)`}),class:"local-album"},[y(o,{id:"album-list",class:"album-list",onScroll:g(K)},{default:b((()=>[(m(!0),v(h,null,_(g(R),((a,s)=>(m(),d(l,{key:s,class:w(g(U)===a.album?"albums choose":"albums"),"content-style":{padding:"12px",display:"flex",flexDirection:"row",alignItems:"center"},onClick:s=>U.value=a.album},{default:b((()=>[q,L("div",z,[L("span",D,j(a.album),1),L("span",P,j(a.artist)+" · "+j(a.num)+" 首",1)])])),_:2},1032,["class","onClick"])))),128))])),_:1},8,["onScroll"]),y(c,{class:"divider",vertical:""}),y(o,{class:"songs-list"},{default:b((()=>[y(f,{name:"fade",mode:"out-in"},{default:b((()=>[(m(),d(r,{key:g(U),data:J(a.songList,g(U))},null,8,["data"]))])),_:1}),y(H,{bottom:"120"},{default:b((()=>[y(p,{size:"26"},{default:b((()=>[y(u,{icon:"chevron-up"})])),_:1})])),_:1})])),_:1})],4)):x("",!0)])),_:1})}}},[["__scopeId","data-v-108ead7f"]]);export{R as default};
