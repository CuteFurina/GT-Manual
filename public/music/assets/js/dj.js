import{_ as a}from"./Pagination.js";import{_ as e}from"./SongList.js";import{a7 as s,s as t,r as l,w as r,f as o,n as c,g as n,G as i,k as d,j as u,T as p,O as m,aa as v,a1 as f,J as g,P as y,R as _,i as k,L as h,W as b,Y as j,ah as w,aC as z,at as C,b1 as $,aJ as q,au as x,ad as N,a0 as S,ap as L,aq as R,v as T}from"./vendor.js";import{_ as I,g as P,a as U,q as D,K as J,e as O,B,d as F,F as G,i as K,f as W}from"./index.js";import{a as Y,b as A,l as E}from"./dj2.js";const H={key:0,class:"dj"},M={key:0,class:"detail"},Q={class:"cover"},V=(a=>(L("data-v-4942ca43"),a=a(),R(),a))((()=>g("div",{class:"cover-loading"},[g("img",{class:"loading-img",src:W,alt:"song"})],-1))),X={class:"data"},Z={class:"creator"},aa={key:0,class:"num-item"},ea={key:1,class:"num-item"},sa={key:1,class:"detail"},ta={class:"data"},la={key:0,class:"list"},ra={key:0,class:"song-list"},oa={key:1,class:"title"},ca=I({__name:"dj",setup(L){const R=s(),I=P(),W=U(),{userLikeData:ca}=t(I),{loadSize:na}=t(W),ia=l(R.currentRoute.value.query.id),da=l(Number(R.currentRoute.value.query?.page)||1),ua=l(null),pa=l(null),ma=l(null),va=l([]),fa=l(0),ga=[{label:"打开源页面链接",key:"open",props:{onclick:()=>{const a=ia.value;a&&window.open(`https://music.163.com/#/djradio?id=${a}`)}},icon:(ya="link",()=>T(b,null,{default:()=>T(O,{icon:ya},null)}))}];var ya;const _a=async a=>{try{if(!a)return!1;ua.value=null,pa.value=null;const e=await Y(a);ua.value=D(e.data,"dj")[0]}catch(e){console.error("获取电台信息出错：",e),$message.error("获取电台信息出现错误")}},ka=async(a,e=na.value,s=0)=>{try{pa.value=[];const t=await A(a,e,s);if(fa.value=t.count,0===fa.value)return pa.value="empty";pa.value=D(t.programs,"dj")}catch(t){console.error("获取电台节目错误：",t),$message.error("获取电台节目出现错误")}},ha=F((a=>{const e=a?.trim();if(!e||""===e)return!0;const s=G(e,pa.value);va.value=s}),300),ba=a=>{const e=ca.value.djs;return!e.length||!e.some((e=>e.id===Number(a)))},ja=F((async a=>{try{if(!K())return $message.warning("请登录后使用");const e=ba(a)?1:0;200===(await E(a,e)).code?($message.success((1===e?"订阅":"取消订阅")+"成功"),await I.setUserLikeDjs()):$message.error((1===e?"订阅":"取消订阅")+"失败，请重试")}catch(e){console.error("订阅出错：",e),$message.error("订阅操作出现错误")}}),300),wa=a=>{R.push({path:"/dj",query:{id:ia.value,page:a}})};return r((()=>R.currentRoute.value),(async a=>{"dj"===a.name&&(da.value=Number(a.query?.page)||1,ia.value=a.query?.id,await _a(ia.value),await ka(ia.value,na.value,(da.value-1)*W.loadSize))})),o((async()=>{await _a(ia.value),await ka(ia.value,na.value,(da.value-1)*W.loadSize)})),(s,t)=>{const l=w,r=m,o=z,L=C,T=$,I=v,P=q,U=f,D=x,F=N,G=e,K=a,W=S;return c(ia)?(n(),i("div",H,[d(p,{name:"fade",mode:"out-in"},{default:u((()=>[c(ua)&&Object.keys(c(ua))?.length?(n(),i("div",M,[g("div",Q,[d(l,{src:c(ua).coverSize.l,"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":c(ua).cover,class:"cover-img","show-toolbar-tooltip":"",onLoad:t[0]||(t[0]=a=>{a.target.style.opacity=1})},{placeholder:u((()=>[V])),_:1},8,["src","preview-src"]),d(l,{src:c(ua).coverSize.m,class:"cover-shadow","preview-disabled":""},null,8,["src"])]),g("div",X,[d(r,{class:"name"},{default:u((()=>[y(_(c(ua).name||"未知电台"),1)])),_:1}),g("div",Z,[d(o,{src:(c(ua).creator?.avatarUrl+"?param=300y$300").replace(/^http:/,"https:"),"fallback-src":"/music/images/pic/avatar.jpg?assest",round:""},null,8,["src"]),d(r,{class:"nickname"},{default:u((()=>[y(_(c(ua).creator?.nickname||"未知创建者"),1)])),_:1}),c(ua).createTime?(n(),k(r,{key:0,class:"create-time",depth:"3"},{default:u((()=>[y(_(c(J)(c(ua).createTime))+" 创建 ",1)])),_:1})):h("",!0),c(ua)?.tags?(n(),k(L,{key:1,bordered:!1,class:"tags",round:"",onClick:t[1]||(t[1]=a=>c(R).push({path:"/dj-type",query:{type:c(ua).tags.id,name:c(ua).tags.name}}))},{default:u((()=>[y(_(c(ua).tags.name),1)])),_:1})):h("",!0)]),c(ua).desc?(n(),k(T,{key:0,tooltip:!1,class:"description","expand-trigger":"click","line-clamp":"2"},{default:u((()=>[d(r,{depth:"3"},{default:u((()=>[y(_(c(ua).desc),1)])),_:1})])),_:1})):(n(),k(r,{key:1,class:"description"},{default:u((()=>[y("太懒了吧，连简介都没写")])),_:1})),d(I,{class:"num"},{default:u((()=>[c(ua)?.count?(n(),i("div",aa,[d(c(b),{depth:"3",size:"18"},{default:u((()=>[d(c(O),{icon:"music-note"})])),_:1}),d(r,{depth:"3"},{default:u((()=>[y(_(c(ua).count),1)])),_:1})])):h("",!0),c(ua)?.updateTime?(n(),i("div",ea,[d(c(b),{depth:"3",size:"18"},{default:u((()=>[d(c(O),{icon:"clock"})])),_:1}),d(r,{depth:"3"},{default:u((()=>[y(_(c(J)(c(ua).updateTime))+" 更新",1)])),_:1})])):h("",!0)])),_:1})])])):(n(),i("div",sa,[d(P,{class:"cover"}),g("div",ta,[d(P,{repeat:4,text:""})])]))])),_:1}),d(I,{class:"menu",justify:"space-between"},{default:u((()=>[d(I,{class:"left"},{default:u((()=>[d(U,{disabled:"empty"===c(pa),focusable:!1,type:"primary",class:"play",tag:"div",circle:"",strong:"",secondary:"",onClick:t[2]||(t[2]=a=>c(B)(c(pa),"dj"))},{icon:u((()=>[d(c(b),{size:"32"},{default:u((()=>[d(c(O),{icon:"play-arrow-rounded"})])),_:1})])),_:1},8,["disabled"]),d(U,{focusable:!1,class:"like",size:"large",tag:"div",round:"",strong:"",secondary:"",onClick:t[3]||(t[3]=a=>c(ja)(c(ia)))},{icon:u((()=>[d(c(b),null,{default:u((()=>[d(c(O),{icon:ba(c(ia))?"favorite-outline-rounded":"favorite-rounded"},null,8,["icon"])])),_:1})])),default:u((()=>[y(" "+_(ba(c(ia))?"订阅电台":"取消订阅"),1)])),_:1}),d(D,{options:ga,trigger:"hover",placement:"bottom-start"},{default:u((()=>[d(U,{focusable:!1,class:"more",size:"large",tag:"div",circle:"",strong:"",secondary:""},{icon:u((()=>[d(c(b),null,{default:u((()=>[d(c(O),{icon:"format-list-bulleted"})])),_:1})])),_:1})])),_:1})])),_:1}),d(I,{class:"right"},{default:u((()=>[d(p,{name:"fade",mode:"out-in"},{default:u((()=>["empty"!==c(pa)&&c(pa)?.length?(n(),k(F,{key:0,value:c(ma),"onUpdate:value":t[4]||(t[4]=a=>j(ma)?ma.value=a:null),"input-props":{autoComplete:!1},class:"search",placeholder:"模糊搜索",clearable:"",onInput:c(ha)},{prefix:u((()=>[d(c(b),{size:"18"},{default:u((()=>[d(c(O),{icon:"search-rounded"})])),_:1})])),_:1},8,["value","onInput"])):h("",!0)])),_:1})])),_:1})])),_:1}),d(p,{name:"fade",mode:"out-in"},{default:u((()=>["empty"!==c(pa)?(n(),i("div",la,[d(p,{name:"fade",mode:"out-in"},{default:u((()=>[c(ma)?c(va)?.length?(n(),k(G,{key:1,data:c(va),type:"dj"},null,8,["data"])):(n(),k(W,{key:2,description:`搜不到关于 ${c(ma)} 的任何节目`,style:{"margin-top":"60px"},size:"large"},{icon:u((()=>[d(c(b),null,{default:u((()=>[d(c(O),{icon:"search-off"})])),_:1})])),_:1},8,["description"])):(n(),i("div",ra,[d(G,{data:c(pa),type:"dj"},null,8,["data"]),c(pa)?.length?(n(),k(K,{key:0,totalCount:c(fa),pageNumber:c(da),onPageNumberChange:wa},null,8,["totalCount","pageNumber"])):h("",!0)]))])),_:1})])):(n(),k(W,{key:1,class:"empty",description:"这个电台还没有节目哦"}))])),_:1})])):(n(),i("div",oa,[d(r,{class:"key"},{default:u((()=>[y("参数不完整")])),_:1}),d(U,{focusable:!1,class:"back",strong:"",secondary:"",onClick:t[5]||(t[5]=a=>c(R).go(-1))},{default:u((()=>[y(" 返回上一页 ")])),_:1})]))}}},[["__scopeId","data-v-4942ca43"]]);export{ca as default};
