import{_ as a}from"./Pagination.js";import{g as e,a as s,_ as t}from"./CommentList.js";import{_ as l,C as o,q as n,e as r,f as i}from"./index.js";import{a7 as u,r as c,w as m,f as d,g as v,G as g,k as p,j as y,T as f,i as _,n as h,J as C,R as k,K as b,X as w,P as x,L as j,ah as q,W as I,aw as N,b0 as P,O as R,ap as z,aq as L,a0 as A}from"./vendor.js";import"./avatar.js";const $=a=>(z("data-v-9de9d796"),a=a(),L(),a),B={class:"comment"},D=$((()=>C("div",{class:"cover-loading"},[C("img",{class:"loading-img",src:i,alt:"loading-img"})],-1))),E={class:"content"},G={class:"name"},J={class:"artist"},K={key:0,class:"all-ar"},O={key:1,class:"all-ar"},S={class:"ar"},T={key:0,class:"all-comments"},V=$((()=>C("div",{id:"to-comments"},null,-1))),W=l({__name:"Comment",setup(l){const i=u(),z=c(i.currentRoute.value.query.id),L=c(null),$=c(1),W=c(null),X=c(null),F=async a=>{try{const e=await o(a),s=n(e?.songs?.[0],"song");L.value=s?.[0]??null}catch(e){console.error("获取歌曲详情失败：",e)}},H=async(a,t=1,l=3,o=20)=>{try{const n=1!==t&&"0"!==W.value?.cursor?W.value.cursor:null,[r,i]=await Promise.all([1===t?e(a,0,10):null,s(a,0,t,l,o,n)]);if(0===i?.data.totalCount)return W.value="empty";W.value=i?.data,X.value=r?.hotComments?.[0]?r.hotComments:"no-comment"}catch(n){console.error("获取评论数据出错：",n),$message.error("获取评论数据出错")}},M=async a=>{$.value=a,await H(i.currentRoute.value.query.id,a),Q()},Q=()=>{const a=document.getElementById("to-comments");a&&a.scrollIntoView({behavior:"smooth"})};return m((()=>i.currentRoute.value),(a=>{"comment"==a.name&&($.value=1,W.value=null,X.value=null,F(a.query.id),H(a.query.id))})),d((()=>{(a=>{if(!a)$message.error("参数不完整"),i.go(-1)})(z.value),F(z.value),H(z.value)})),(e,s)=>{const l=q,o=r,n=I,i=N,u=P,c=t,m=R,d=a,F=A;return v(),g("div",B,[p(f,{name:"fade",mode:"out-in"},{default:y((()=>[(v(),_(i,{key:h(z),"content-style":{display:"flex",flexDirection:"row",alignItems:"center",padding:"16px",height:"100%"},class:"song-detail"},{default:y((()=>[p(l,{src:h(L)?.coverSize?.s||h(L)?.cover,class:"cover-img","preview-disabled":"",onLoad:s[0]||(s[0]=a=>{a.target.style.opacity=1})},{placeholder:y((()=>[D])),_:1},8,["src"]),C("div",E,[C("div",G,k(h(L)?.name||"未知曲目"),1),C("div",J,[p(n,{depth:"3",size:"20"},{default:y((()=>[p(o,{icon:"account-music"})])),_:1}),h(L)?.artists&&Array.isArray(h(L)?.artists)?(v(),g("div",K,[(v(!0),g(b,null,w(h(L).artists,(a=>(v(),g("span",{key:a.id,class:"ar"},k(a.name),1)))),128))])):(v(),g("div",O,[C("span",S,k(h(L)?.artists||"未知艺术家"),1)]))])])])),_:1}))])),_:1}),p(f,{name:"fade",mode:"out-in"},{default:y((()=>["empty"!==h(W)?(v(),g("div",T,[V,1===h($)&&"no-comment"!==h(X)?(v(),g(b,{key:0},[p(u,{class:"title",prefix:"bar"},{default:y((()=>[x("热门评论 ")])),_:1}),p(c,{data:h(X),loadingNum:10},null,8,["data"])],64)):j("",!0),p(u,{class:"title",prefix:"bar"},{default:y((()=>[p(m,null,{default:y((()=>[x("全部评论")])),_:1}),h(W)?.totalCount?(v(),_(m,{key:0,class:"num",depth:"3"},{default:y((()=>[x(k(h(W).totalCount)+" + ",1)])),_:1})):j("",!0)])),_:1}),p(c,{data:h(W)?.comments},null,8,["data"]),p(d,{totalCount:h(W)?.totalCount,pageNumber:h($),onPageNumberChange:M},null,8,["totalCount","pageNumber"])])):(v(),_(F,{key:1,description:"很抱歉，该歌曲暂无评论",style:{"margin-top":"60px"},size:"large"}))])),_:1})])}}},[["__scopeId","data-v-9de9d796"]]);export{W as default};
